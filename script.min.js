function resizeTextArea(e){let{style:t,value:n}=e;t.height=t.minHeight="auto",t.minHeight=`${Math.min(e.scrollHeight+4,parseInt(e.style.maxHeight))}px`,t.height=`${e.scrollHeight+4}px`}const inputContainer=document.querySelector(".input-container"),input=document.getElementById("text");input.addEventListener("input",()=>{input.setAttribute("value",input.value),resizeTextArea(input),""!==input.value?inputContainer.classList.add("has-value"):inputContainer.classList.remove("has-value")}),FilePond.registerPlugin(FilePondPluginImageExifOrientation,FilePondPluginImagePreview,FilePondPluginPdfPreview,FilePondPluginMediaPreview,FilePondPluginGetFile),FilePond.setOptions({server:{process(e,t,n,a,s,p,o,i,r){let l=new FormData;l.append("type","upload"),l.append("fieldName",e),l.append("file",t),l.append("name",t.name);let u=new XMLHttpRequest;return u.open("POST","server.php"),u.upload.onprogress=e=>{p(!1,e.loaded,e.total)},u.onload=function(){u.status>=200&&u.status<300?a(u.responseText):s("oh no")},u.send(l),{abort(){u.abort(),o()}}},revert(e,t,n){let a=new FormData;a.append("type","revert"),a.append("id",e);let s=new XMLHttpRequest;s.open("POST","server.php"),s.onload=function(){s.status>=200&&s.status<300?t():n("oh my goodness")},s.send(a)},remove(e,t,n){let a=new FormData;a.append("type","remove"),a.append("path",e);let s=new XMLHttpRequest;s.open("POST","server.php"),s.onload=function(){s.status>=200&&s.status<300?t():n("oh my goodness")},s.send(a)},load(e,t,n,a,s,p){fetch(new Request(e)).then(e=>e.blob()).then(t)}}});const inputElement=document.querySelector('input[type="file"]'),pond=FilePond.create(inputElement,{allowDownloadByUrl:!1,pdfComponentExtraParams:"toolbar=0&view=fitW&page=1"});function sendText(){let e=new FormData;e.append("type","updatetext"),e.append("text",Base64.encode(document.getElementById("text").value));let t=new XMLHttpRequest;t.open("POST","server.php"),t.send(e)}function updateFiles(e){let t=pond.getFiles();e.forEach(e=>{let n=t.find(t=>t.getMetadata("name")===e.substring(8)||t.source.name===e.substring(8));n||pond.addFile(e,{type:"local",metadata:{name:e.substring(8)}})}),t.forEach(t=>{if(5==t.status){let n=e.some(e=>t.getMetadata("name")===e.substring(8)||t.source.name===e.substring(8));n||pond.removeFile(t)}})}var source=new EventSource("stream.php");source.onmessage=function(e){let t=JSON.parse(Base64.decode(e.data));document.getElementById("text").value=Base64.decode(t.text),input.dispatchEvent(new Event("input")),updateFiles(t.files)};